---
layout: post
title: "vsftpd配置注意事项"
date: 2020-04-30
comments: false
categories: 运维
---

### 服务端口和数据端口

* 服务端口 21，负责指令传输，如登录
* 数据渡口 通信过程决定，如获取目录数据

```bash
被动模式，可以通过pasv_min_port、pasv_max_port设置数据端口范围
```

### 主动模式和被动模式

* 主动模式 - 客户端开端口，服务器来连
* 被动模式 - 服务器开端口，客户端来连
    
### 用户添加

```
useradd -d ftp根路径  -s /sbin/nologin 用户名
passwd 用户名
```
需要在/etc/shells添加/sbin/nologin，否则ftp用户无法使用

```bash
root@nexhome-OptiPlex-390:/home/nexhome# cat /etc/shells
# /etc/shells: valid login shells
/bin/sh
/bin/bash
/bin/rbash
/bin/dash
/sbin/nologin
```

### 配置

vsftpd.conf

* listen和listen_ipv6不能同时设置为YES，只需设置listen为YES，否则可能会到只`500 Illegal PORT command`错误


### 问题

* (1) FileZilla出现"转换命令到8 bit编码失败"

```
进入FileZilla站点管理器，进入【字符集】设置"强制UTF-8"
```

* (2) 使用TotalCommand出现`500 Illegal PORT command`

```
返回的IP可访问，但端口不可访问
```